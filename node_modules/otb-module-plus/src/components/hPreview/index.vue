<template>
  <div>
    <div
      :style="{ width: `${width}vw`, height: `${height ? height : width}vw` }"
      class="main"
    >
      <div
        v-if="['pdf'].includes(fileType)"
        class="iframe-box"
        @click="preview"
      >
        <iframe :src="url" class="iframe" />
      </div>

      <el-image
        v-else
        :preview-src-list="urlList || [url]"
        :src="url"
        class="image"
      />
    </div>

    <el-dialog v-model="previewDialog" append-to-body>
      <div v-if="['pdf'].includes(fileType)" class="iframe-box">
        <iframe :src="url" class="iframe" />
      </div>
    </el-dialog>
  </div>
</template>

<script lang="ts" setup>
import { ref, watchEffect } from "vue"
import { fileLinkFileType } from "../../utils/tool"

export interface PreviewProps {
  url: string
  urlList?: string[]
  width?: number | string
  height?: number | string
}

const props = withDefaults(defineProps<PreviewProps>(), {
  width: 1.5
})

const fileType = ref("")
const previewDialog = ref(false)

watchEffect(() => {
  fileType.value = fileLinkFileType(props.url) as string
})
const preview = () => {
  previewDialog.value = true
}
</script>

<script lang="ts">
export default {
  name: "HPreview"
}
</script>

<style lang="scss" scoped>
.iframe-box {
  height: 60vh;
  cursor: pointer;

  .iframe {
    width: 100%;
    height: 100%;
  }
}

.main {
  iframe {
    pointer-events: none;
  }

  .iframe-box {
    height: 100%;
  }

  .image {
    width: 100%;
    height: 100%;
  }
}
</style>
