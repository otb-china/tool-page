import axios, { type AxiosInstance } from "axios"
import { ElNotification } from "element-plus"
import { SStorage } from "./sessionStorage"

// 创建axios实例
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_BASE_URL,
  timeout: 1000 * 60
})
// 请求拦截器
service.interceptors.request.use(
  (config: any) => {
    const loginBack = SStorage.loginBack.getter()
    if (loginBack?.access_token) {
      config.headers.Token = `Bearer ${loginBack?.access_token}`
    }
    return config
  },
  (error: any) => {
    return Promise.reject(error)
  }
)
const errorMessage = (status: number) => {
  switch (status) {
    case 400:
      return "错误请求"
    case 401:
      return "未登录,请重新登录"
    case 403:
      return "拒绝访问"
    case 404:
      return "请求错误，未找到该资源"
    case 405:
      return "请求方法未允许"
    case 408:
      return "请求超时"
    case 500:
      return "服务器出错"
    case 501:
      return "网络未实现"
    case 502:
      return "网络错误"
    case 503:
      return "服务不可用"
    case 504:
      return "网络超时"
    case 505:
      return "http版本不支持该请求"
    default:
      return `请求出错(${status})!`
  }
}
// 响应拦截器
service.interceptors.response.use(
  (response: any) => {
    return response.data
  },
  (error: any) => {
    if (error?.response !== null) {
      ElNotification({
        type: "error",
        message: errorMessage(error.response.status)
      })
    }
    return Promise.reject(error)
  }
)

export default service
